<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge, chrome=1" />
    <title>Microsoft Graph API Auth</title>
    <link href='https://fonts.loli.net/icon?family=Material+Icons' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
</head>
<body>
    <nav>
        <div class="nav-wrapper">
            <a href="#" class="brand-logo center">Microsoft Graph API Auth</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="https://xn--i8sr36a.wang/">橘子的小站</a></li>
                <li><a href="https://github.com/heymind/heymind.github.io/blob/master/tools/microsoft-graph-api-auth.html">源代码</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">

        <div class="card">
            <div class="card-content">
                <span class="card-title">准备工作</span>
                <ol>
                    <li>
                        <p>打开 <a
                                href="https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade">Azure 应用注册</a>
                            注册一个新应用</p>
                        <p>需要将 <code>redirect_uri</code> 填写为 <code>https://pages.icedeer.net/tools/microsoft-graph-api-auth</span></code></p>
                    </li>
                    <li>
                        <p>切换到 <code>证书和密码</code> 选项卡， 创建新的 <code>客户端密码</code> ，
                            把它粘贴到下面的输入框中。</p>
                    </li>
                    <li>
                        <p>切换到 <code>API 权限</code> 选项卡， 添加你需要的权限。</p>
                        <p>对于 OneDrive Index ， 需要以下权限： <code>offline_access</code>,
                            <code>Files.Read</code>, <code>Files.Read.All</code> .</p>
                        <p>&nbsp;</p>
                    </li>

                </ol>
            </div>
        </div>

        <form class="card" action="https://login.microsoftonline.com/common/oauth2/v2.0/authorize" method="GET">
            <div class="card-content">
                <span class="card-title">登录并获取 Code</span>
                <div class="input-field">
                    <input placeholder="client_id" name="client_id" type="text">
                    <label for="client_id">Client ID</label>
                </div>
                <div class="input-field">
                    <input placeholder="offline_access," name="scope" type="text"
                        value="offline_access Files.Read Files.Read.All">
                    <label for="scope">Scope</label>
                </div>
                <div class="input-field">
                    <input placeholder="Placeholder" name="redirect_uri" type="text">
                    <label for="redirect_uri">Redirect Uri</label>
                </div>
                <input name="response_type" type="text" hidden value="code">
            </div>
            <div class="card-action">
                <input type="submit" value="Authorize" class="waves-effect waves-teal btn-flat" />
            </div>
        </form>

        <form class="card" action="https://login.microsoftonline.com/common/oauth2/v2.0/token" method="POST">
            <div class="card-content">
                <span class="card-title">获取 Access Token</span>
                <div class="input-field">
                    <input placeholder="client_id" name="client_id" type="text">
                    <label for="client_id">Client ID</label>
                </div>
                <div class="input-field">
                    <input placeholder="offline_access," name="client_secret" type="text">
                    <label for="client_secret">Client Secret</label>
                </div>
                <div class="input-field">
                    <input placeholder="offline_access," name="code" type="text">
                    <label for="scope">Code</label>
                </div>
                <div class="input-field">
                    <input placeholder="Placeholder" name="redirect_uri" type="text">
                    <label for="redirect_uri">Redirect Uri</label>
                </div>
            </div>
            <input name="grant_type" type="text" hidden value="authorization_code">
            <div class="card-action">
                <input type="submit" value="Get Token" class="waves-effect waves-teal btn-flat" />
            </div>
        </form>


        <form class="card" action="https://login.microsoftonline.com/common/oauth2/v2.0/token" method="POST">
            <div class="card-content">
                <span class="card-title">刷新 Token</span>
                <div class="input-field">
                    <input placeholder="client_id" name="client_id" type="text">
                    <label for="client_id">Client ID</label>
                </div>
                <div class="input-field">
                    <input placeholder="offline_access," name="client_secret" type="text">
                    <label for="client_secret">Client Secret</label>
                </div>
                <div class="input-field">
                    <input placeholder="offline_access," name="refresh_token" type="text">
                    <label for="refresh_token">Refresh Token</label>
                </div>
                <div class="input-field">
                    <input placeholder="Placeholder" name="redirect_uri" type="text">
                    <label for="redirect_uri">Redirect Uri</label>
                </div>
            </div>
            <input name="grant_type" type="text" hidden value="refresh_token">
            <div class="card-action">
                <input type="submit" value="Get Token" class="waves-effect waves-teal btn-flat" />
            </div>
        </form>


    </div>


  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <style>
        .card-title {
            padding-bottom: 1 rem;
        }
    </style>
    <script>
        function syncField(name, value) {
            if (!value) value = localStorage.getItem(name);
            if (value)
                document.querySelectorAll(`input[name=${name}]`).forEach(ii => ii.value = value);
            document.querySelectorAll(`input[name=${name}]`).forEach((i) => i.onchange = (e) => {
                localStorage.setItem(name, e.target.value);
                document
                    .querySelectorAll(`input[name=${name}]`).forEach(ii => ii.value = e.target.value)
            });
        }
        window.onload = function () {

            syncField("client_id");
            syncField("redirect_uri",  "https://pages.icedeer.net/tools/microsoft-graph-api-auth");
            document.querySelector("#location").textContent = "https://pages.icedeer.net/tools/microsoft-graph-api-auth";


            const params = (new URL(document.location)).searchParams;
            let code = params.get("code");
            if (code) {
                alert(`Got Code ${code}`);
                document.querySelector("input[name=code]").value = code;
            }
        }
    </script>
</body>

</html>
